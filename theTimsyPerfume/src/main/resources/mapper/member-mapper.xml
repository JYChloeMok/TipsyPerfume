<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="userMapper">

	<resultMap id="ReceiverResultSet" type="receiver">
		<result column="RECEIVER_NAME" property="receiverName" />
		<result column="PHONE" property="phone" />
		<result column="ADDRESS" property="address" />
		<result column="ADRESS_DETAIL" property="addressDetail" />
		<result column="POSTAL_CODE" property="postalCode" />
	</resultMap>


	<!-- 로그인용 쿼리문 -->
	<select id="loginUser" parameterType="user" resultType="user">
		SELECT
			USER_NO userNo,
            USER_EMAIL userEmail,
            NICKNAME nickName,
            USER_PWD userPwd,
            USER_NAME userName,
            STATUS status,
            MEMBER_TYPE memberType,
            BUSINESS_REG businessReg,
            ADULT_STATUS adultStatus,
            BIRTH_DATE birthDate,
            ENROLL_DATE enrollDate,
            USER_PROFILE userProfile,
			
			PHONE phone,
			ADDRESS address,
			ADDRESS_DETAIL addressDetail,
			POSTAL_CODE postalCode
			
		FROM
			TB_USER
		left JOIN
			TB_RECEIVER USING(USER_NO)
		WHERE
			USER_EMAIL = #{userEmail}
			
		<!--  사용자는 DB_userPwd컬럼에 저장된 암호화된 비밀번호를 알 수 없기 때문에 비밀번호 조건을 나중에 제거
		AND
			USER_PWD = #{userPwd}
		-->
			
		AND
			STATUS='Y'
	</select>
	  
	


	<!-- 회원가입용 쿼리문1 -->
	<insert id="insertUser" parameterType="user">
	INSERT
	INTO
		TB_USER
		(
			USER_NO ,
            USER_EMAIL ,
            NICKNAME ,
            USER_PWD ,
            USER_NAME ,
            BIRTH_DATE 
           
		)
	VALUES
		(
		SEQ_USER.NEXTVAL,
        #{userEmail},
        #{nickName},
        #{userPwd},
        #{userName},
        #{birthDate}
       
		)
	</insert>

	<!-- 회원가입용 쿼리문2 -->
	<insert id="insertUser2" parameterType="user">
	INSERT
	INTO
		TB_RECEIVER
			(
			RECEIVER_NO,
			USER_NO,
			RECEIVER_NAME,

			PHONE ,
			ADDRESS ,
			ADDRESS_DETAIL ,
			POSTAL_CODE
			)
	VALUES
		(
		SEQ_RECEIVER.NEXTVAL,
		SEQ_USER.CURRVAL,
		#{receiverName},
		
		#{phone},
		#{address},
		#{addressDetail},
		#{postalCode}
		)
	</insert>


	<select id="emailCheck" parameterType="string" resultType="_int">
		SELECT
			COUNT(*)
		FROM
			TB_USER
		WHERE
			USER_EMAIL = #{checkEmail}
	</select>

	<insert id="insertSecret" parameterType="com.kh.ttp.user.model.vo.AuthVO">
		INSERT
		INTO
			TB_AUTH
			(authEmail, authCode, authDate)
		VALUES
			(#{authEmail}, #{authCode}, sysdate)
	</insert>
	
	
	<select id="selectReceiver" parameterType="_int" resultMap="ReceiverResultSet">
	SELECT
		RECEIVER_NAME ,
		PHONE ,
		ADDRESS ,
		ADDRESS_DETAIL ,
		POSTAL_CODE 
	FROM
		TB_RECEIVER
	WHERE
		USER_NO = #{userNo}
	</select>
	
	
	<!-- 성인인증 여부 확인용 SQL문 -->
	<select id="isUserAdult" parameterType="_int" resultType="_int">
		SELECT
			   COUNT(1)
		  FROM
		  	   TB_USER
		 WHERE
		 	   USER_NO = #{userNo}
		   AND
		 	   ADULT_STATUS = 'Y'
	</select>

</mapper>
