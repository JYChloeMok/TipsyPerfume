<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="productMapper1">
	
	<resultMap id="productSelectResultSet" type="productSelect">
		<result column="PDT_NO" property="pdtNo" />
		<result column="PDT_NAME" property="pdtName" />
		<result column="PDT_INTRO" property="pdtIntro" />
		<result column="PDT_DESCRIPTION" property="pdtDescription" />
		<result column="PDT_MANUFAC" property="pdtManufac" />
		<result column="REVIEW_AVG" property="reviewAvg" />
		<result column="PDT_IMG_SRC" property="pdtImgSrc" />
	</resultMap>
	
	<!-- 브랜드 주류 / 향수 상품(판매중 상태Y) 개수 카운트 -->
	<select id="selectProductCount" parameterType="string" resultType="_int">
		SELECT COUNT(*)
		FROM TB_PRODUCT
		JOIN TB_PRODUCT_CATEGORY USING(PDT_CATEG_NO)
		WHERE PDT_CTEG = #{pdtCteg}
		AND PDT_FAMILY = 'B'
		AND PDT_STATUS = 'Y'
	</select>
	
	<!-- 브랜드 주류 / 향수 메인보기(6개조회) & 전체보기(12개조회)를 위한 쿼리문 -->
	<select id="productMainList" parameterType="map" resultMap="productSelectResultSet">
SELECT PDT_NO, PDT_NAME, PDT_INTRO, PDT_DESCRIPTION, PDT_MANUFAC, PDT_FILE_PATH || '/' || PDT_FILE_UPLOAD "PDT_IMG_SRC", REVIEW_AVG
  FROM TB_PRODUCT
  JOIN TB_PRODUCT_CATEGORY USING(PDT_CATEG_NO)
  JOIN TB_PRODUCT_FILE USING(PDT_NO)
  LEFT JOIN(SELECT PDT_NO, AVG(NVL(REVIEW_SCORE, 0)) "REVIEW_AVG"
FROM TB_PRODUCT
LEFT JOIN TB_REVIEW USING(PDT_NO)
WHERE REVIEW_STATE = 'Y'
OR REVIEW_STATE IS NULL
GROUP BY PDT_NO) USING(PDT_NO)
 WHERE PDT_CTEG = #{pdtCteg}
   AND PDT_FAMILY = 'B'
   AND PDT_STATUS = 'Y'
   AND PDT_FILE_INDEX = 0
ORDER BY PDT_NO DESC
	</select>
	
	
	
	
</mapper>