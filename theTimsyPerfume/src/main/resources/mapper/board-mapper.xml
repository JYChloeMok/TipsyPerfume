<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="boardMapper">

<resultMap type="board" id="boardResultSet">
	<result column="BOARD_NO" property="boardNo"/>
	<result column="NICKNAME" property="boardWriter"/>
	<result column="BOARD_TITLE" property="boardTitle"/>
	<result column="BOARD_CONTENT" property="boardContent"/>
	<result column="BOARD_CREATE_DATE" property="boardCreateDate"/>
	<result column="BOARD_MODIFY_DATE" property="boardModifyDate"/>
	<result column="BOARD_CTGY_NAME" property="boardCtgyCode"/>
	<result column="BOARD_STATE" property="boardState"/>
	<result column="BOARD_COUNT" property="boardCount"/>
</resultMap>

<select id="countBoardList" parameterType="string" resultType="_int">
SELECT
    COUNT(*)
FROM TB_BOARD
WHERE
    BOARD_STATE='Y'
AND
    BOARD_CTGY_CODE=#{boardCtgy}
</select>
<select id="selectBoardList" parameterType="string" resultMap="boardResultSet">
SELECT
    BOARD_NO,
    NICKNAME,
    BOARD_TITLE,
    TO_CHAR(BOARD_CREATE_DATE,'YYYY-MM-dd') "BOARD_CREATE_DATE",
    TO_CHAR(BOARD_MODIFY_DATE,'YYYY-MM-dd') "BOARD_MODIFY_DATE",
    BOARD_CTGY_CODE,
    BOARD_STATE,
    BOARD_COUNT
FROM TB_BOARD
JOIN TB_USER USING(USER_NO)
WHERE
    BOARD_STATE='Y'
AND
    BOARD_CTGY_CODE=#{boardCtgy}
</select>
<update id="increaseBoardCount" parameterType="_int">
UPDATE TB_BOARD SET BOARD_COUNT=BOARD_COUNT+1 WHERE BOARD_NO=#{boardNo}
</update>
<select id="selectBoard" parameterType="_int" resultMap="boardResultSet">
SELECT
    BOARD_NO,
    NICKNAME,
    BOARD_TITLE,
    BOARD_CONTENT,
    TO_CHAR(BOARD_CREATE_DATE,'YYYY-MM-dd HH24:mm') "BOARD_CREATE_DATE",
    TO_CHAR(BOARD_MODIFY_DATE,'YYYY-MM-dd') "BOARD_MODIFY_DATE",
    BOARD_CTGY_NAME,
    BOARD_COUNT
FROM TB_BOARD
JOIN TB_USER USING(USER_NO)
JOIN TB_BOARD_CTGY USING(BOARD_CTGY_CODE)
WHERE
    BOARD_STATE='Y'
AND
    BOARD_NO=#{boardNo}
ORDER BY BOARD_CREATE_DATE DESC
</select>

<select id="selectRecommend" parameterType="recommend" resultType="string">
SELECT
    BOARD_LIKE_FLAG
FROM TB_BOARD_LIKE
WHERE
    USER_NO = #{userNo}
AND
    BOARD_NO = #{contentNo}
</select>
<update id="updateRecommend" parameterType="recommend">
UPDATE
    TB_BOARD_LIKE
SET BOARD_LIKE_FLAG = #{likeFlag}
WHERE
    USER_NO = #{userNo}
AND
    BOARD_NO = #{contentNo}
</update>
<insert id="insertRecommend" parameterType="recommend">
INSERT INTO TB_BOARD_LIKE(
    USER_NO,
    BOARD_NO,
    BOARD_LIKE_FLAG
) VALUES (
	#{userNo},
	#{contentNo},
	#{likeFlag}
)
</insert>
<select id="countRecommend" parameterType="_int" resultType="recommend">
SELECT
    TO_CHAR(COUNT(CASE WHEN BOARD_LIKE_FLAG='L' THEN 1 END),'FM999,999,999') likeCount,
    TO_CHAR(COUNT(CASE WHEN BOARD_LIKE_FLAG='D' THEN 1 END),'FM999,999,999') dislikeCount
FROM TB_BOARD_LIKE
WHERE
    BOARD_NO = #{contentNo}
</select>
<select id="selectCtgyName" parameterType="string" resultType="string">
SELECT
	BOARD_CTGY_NAME
FROM
	TB_BOARD_CTGY
WHERE
	BOARD_CTGY_CODE=#{boardCtgy}
</select>

<insert id="insertBoard" parameterType="board">
INSERT INTO TB_BOARD(
    BOARD_NO,
    USER_NO,
    BOARD_TITLE,
    BOARD_CONTENT,
    BOARD_CTGY_CODE
) VALUES (
    SEQ_BOARD.NEXTVAL,
    #{boardWriter},
    #{boardTitle},
    #{boardContent},
    #{boardCtgyCode}
)
</insert>
</mapper>